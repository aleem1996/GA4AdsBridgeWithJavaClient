report.costvsrevenue.monthly = SELECT round(sum(cd.cost),2) as 'SOURCE__NAME Cost', round(sum(case when :statType IN ('purchase_centric', 'weekly_stats') and cd.campaignDetailSource = 'Facebook' then (ca.revenue1DayView + ca.revenue28DayClick) else case when 'partial' = :view  then cd.revenue else case when cd.campaignDetailSource IN ('Analytics', 'Bing', 'StackAdapt') then case when :statType IN ('purchase_centric', 'weekly_stats') or 'unique' = :view then (cd.uniqueAssistedConversionRevenue + cd.directConversionRevenue) else (cd.assistedConversionRevenue + cd.directConversionRevenue) end else cd.revenue end end end), 2) as 'SOURCE__NAME Revenue', DATE_FORMAT(cd.startDate, '%b-%y') as 'Label'  FROM dm.CampaignDetail cd LEFT JOIN dm.CampaignAttribution ca on cd.campaignId = ca.campaignId and cd.startDate = ca.startDate and cd.endDate = ca.endDate and ca.isManual = false where cd.startDate >= :startDate  and cd.endDate <= :endDate  and cd.campaignDetailSource = :source group by cd.campaignDetailSource, year(cd.startDate), month(cd.startDate)
#report.costvsrevenue.monthly = SELECT ifNull(round(sum(cd.cost),2),0) as 'SOURCE__NAME Cost', ifNull(round(sum(case when :statType IN ('purchase_centric', 'weekly_stats') and cd.campaignDetailSource = 'Facebook' then (ca.revenue1DayView + ca.revenue28DayClick) else case when 'partial' = :view  then cd.revenue else case when cd.campaignDetailSource IN ('Analytics', 'Bing', 'StackAdapt') then case when :statType IN ('purchase_centric', 'weekly_stats') or 'unique' = :view then (cd.uniqueAssistedConversionRevenue + cd.directConversionRevenue) else (cd.assistedConversionRevenue + cd.directConversionRevenue) end else cd.revenue end end end), 2), 0) as 'SOURCE__NAME Revenue', tt.Label FROM (Select Label, (CASE WHEN StartDate < :startDate THEN :startDate ELSE StartDate END) StartDate, (CASE WHEN EndDate > :endDate THEN :endDate ELSE EndDate END) EndDate from (Select distinct DATE_FORMAT(gen_date, '%b-%y') Label, DATE_SUB(gen_date, INTERVAL DAYOFMONTH(gen_date)-1 DAY) StartDate, LAST_DAY(gen_date) EndDate from (select adddate('1970-01-01 00:00:00',t4*10000 + t3*1000 + t2*100 + t1*10 + t0) gen_date from (select 0 t0 union select 1 union select 2 union select 3 union select 4 union select 5 union select 6 union select 7 union select 8 union select 9) t0, (select 0 t1 union select 1 union select 2 union select 3 union select 4 union select 5 union select 6 union select 7 union select 8 union select 9) t1, (select 0 t2 union select 1 union select 2 union select 3 union select 4 union select 5 union select 6 union select 7 union select 8 union select 9) t2, (select 0 t3 union select 1 union select 2 union select 3 union select 4 union select 5 union select 6 union select 7 union select 8 union select 9) t3, (select 0 t4 union select 1 union select 2 union select 3 union select 4 union select 5 union select 6 union select 7 union select 8 union select 9) t4) v Where gen_date between :startDate and :endDate) m) tt LEFT JOIN dm.CampaignDetail cd on cd.startDate >= tt.StartDate  and cd.endDate <= tt.EndDate AND cd.campaignDetailSource = :source LEFT JOIN dm.CampaignAttribution ca on cd.campaignId = ca.campaignId and cd.startDate = ca.startDate and cd.endDate = ca.endDate and ca.isManual = false group by cd.campaignDetailSource, tt.Label order by tt.StartDate;

report.costvsrevenue.yearly = SELECT round(sum(cd.cost),2) as 'SOURCE__NAME Cost', round(sum(case when :statType IN ('purchase_centric', 'weekly_stats') and cd.campaignDetailSource = 'Facebook' then (ca.revenue1DayView + ca.revenue28DayClick) else case when 'partial' = :view  then cd.revenue else case when cd.campaignDetailSource IN ('Analytics', 'Bing', 'StackAdapt') then case when :statType IN ('purchase_centric', 'weekly_stats') or 'unique' = :view then (cd.uniqueAssistedConversionRevenue + cd.directConversionRevenue) else (cd.assistedConversionRevenue + cd.directConversionRevenue) end else cd.revenue end end end), 2) as 'SOURCE__NAME Revenue', DATE_FORMAT(cd.startDate, '%Y') as 'Label'  FROM dm.CampaignDetail cd LEFT JOIN dm.CampaignAttribution ca on cd.campaignId = ca.campaignId and cd.startDate = ca.startDate and cd.endDate = ca.endDate and ca.isManual = false where cd.startDate >= :startDate  and cd.endDate <= :endDate  and cd.campaignDetailSource = :source group by cd.campaignDetailSource, year(cd.startDate)
#report.costvsrevenue.yearly = SELECT ifNull(ROUND(SUM(cd.cost), 2), 0) AS 'SOURCE__NAME Cost', ifNull(ROUND(SUM(CASE WHEN :statType IN ('purchase_centric' , 'weekly_stats') AND cd.campaignDetailSource = 'Facebook' THEN (ca.revenue1DayView + ca.revenue28DayClick) ELSE CASE WHEN 'partial' = :view THEN cd.revenue ELSE CASE WHEN cd.campaignDetailSource IN ('Analytics' , 'Bing', 'StackAdapt') THEN CASE WHEN :statType IN ('purchase_centric' , 'weekly_stats') OR 'unique' = :view THEN (cd.uniqueAssistedConversionRevenue + cd.directConversionRevenue) ELSE (cd.assistedConversionRevenue + cd.directConversionRevenue) END ELSE cd.revenue END END END), 2), 0) AS 'SOURCE__NAME Revenue', tt.Label FROM ( Select Label, (CASE WHEN StartDate < :startDate THEN :startDate ELSE StartDate END) StartDate, (CASE WHEN EndDate > :endDate THEN :endDate ELSE EndDate END) EndDate From ( SELECT DISTINCT DATE_FORMAT(gen_date, '%Y') Label, DATE_SUB(gen_date, INTERVAL DAYOFYEAR(gen_date) - 1 DAY) StartDate, DATE(CONCAT(YEAR(gen_date), '-12-31')) EndDate from (select adddate('1970-01-01',t4*10000 + t3*1000 + t2*100 + t1*10 + t0) gen_date from (select 0 t0 union select 1 union select 2 union select 3 union select 4 union select 5 union select 6 union select 7 union select 8 union select 9) t0, (select 0 t1 union select 1 union select 2 union select 3 union select 4 union select 5 union select 6 union select 7 union select 8 union select 9) t1, (select 0 t2 union select 1 union select 2 union select 3 union select 4 union select 5 union select 6 union select 7 union select 8 union select 9) t2, (select 0 t3 union select 1 union select 2 union select 3 union select 4 union select 5 union select 6 union select 7 union select 8 union select 9) t3, (select 0 t4 union select 1 union select 2 union select 3 union select 4 union select 5 union select 6 union select 7 union select 8 union select 9) t4) v Where gen_date between :startDate and :endDate ) m  )tt LEFT JOIN dm.CampaignDetail cd on Date(cd.StartDate) between tt.StartDate and tt.EndDate AND cd.campaignDetailSource = :source LEFT JOIN dm.CampaignAttribution ca ON cd.campaignId = ca.campaignId AND cd.startDate = ca.startDate AND cd.endDate = ca.endDate AND ca.isManual = FALSE group by cd.campaignDetailSource, tt.Label order by tt.StartDate;

report.costvsrevenue.weekly = SELECT round(sum(cd.cost),2) as 'SOURCE__NAME Cost', round(sum(case when :statType IN ('purchase_centric', 'weekly_stats') and cd.campaignDetailSource = 'Facebook' then (ca.revenue1DayView + ca.revenue28DayClick) else case when 'partial' = :view  then cd.revenue else case when cd.campaignDetailSource IN ('Analytics', 'Bing', 'StackAdapt') then case when :statType IN ('purchase_centric', 'weekly_stats') or 'unique' = :view then (cd.uniqueAssistedConversionRevenue + cd.directConversionRevenue) else (cd.assistedConversionRevenue + cd.directConversionRevenue) end else cd.revenue end end end), 2) as 'SOURCE__NAME Revenue', CONCAT(DATE_FORMAT(SUBSTRING_INDEX(group_concat(DISTINCT cd.startDate ORDER BY cd.startDate SEPARATOR ' '), ' ', 1), '%m/%d/%y'), '-' ,DATE_FORMAT(case when SUBSTRING_INDEX(group_concat(DISTINCT cd.startDate ORDER BY cd.startDate SEPARATOR ' '), ' ', 1) = '2017-12-26' then DATE_ADD(cd.startDate, INTERVAL 5 DAY) else DATE_ADD(SUBSTRING_INDEX(group_concat(DISTINCT cd.startDate ORDER BY cd.startDate SEPARATOR ' '), ' ', 1), INTERVAL 6 DAY) end, '%m/%d/%y')) as 'Label' FROM dm.CampaignDetail cd LEFT JOIN dm.CampaignAttribution ca on cd.campaignId = ca.campaignId and cd.startDate = ca.startDate and cd.endDate = ca.endDate and ca.isManual = false where cd.startDate >= :startDate  and cd.endDate <= :endDate and cd.campaignDetailSource = :source group by cd.campaignDetailSource, yearweek(cd.startDate, 1) order by cd.startDate;
#report.costvsrevenue.weekly = SELECT ifNull(ROUND(SUM(cd.cost), 2), 0) AS 'SOURCE__NAME Cost', ifNull(ROUND(SUM(CASE WHEN :statType IN ('purchase_centric' , 'weekly_stats') AND cd.campaignDetailSource = 'Facebook' THEN (ca.revenue1DayView + ca.revenue28DayClick) ELSE CASE WHEN 'partial' = :view THEN cd.revenue ELSE CASE WHEN cd.campaignDetailSource IN ('Analytics' , 'Bing', 'StackAdapt') THEN CASE WHEN :statType IN ('purchase_centric' , 'weekly_stats') OR 'unique' = :view THEN (cd.uniqueAssistedConversionRevenue + cd.directConversionRevenue) ELSE (cd.assistedConversionRevenue + cd.directConversionRevenue) END ELSE cd.revenue END END END), 2), 0) AS 'SOURCE__NAME Revenue', tt.Label FROM (Select Concat(DATE_FORMAT(StartDate, '%m/%d/%y'), '-', DATE_FORMAT(EndDate, '%m/%d/%y')) Label, StartDate, EndDate from (Select (CASE WHEN StartDate < :startDate THEN :startDate ELSE StartDate END) StartDate, (CASE WHEN EndDate > :endDate THEN :endDate ELSE EndDate END) EndDate from (Select distinct DATE_ADD(DATE_ADD(gen_date, INTERVAL -WEEKDAY(gen_date)-1 DAY), INTERVAL 1 DAY) StartDate, date_add(date_add(date_add(gen_date, interval  -WEEKDAY(gen_date)-1 day), interval 6 day), interval 1 day) EndDate from (select adddate('1970-01-01 00:00:00',t4*10000 + t3*1000 + t2*100 + t1*10 + t0) gen_date from (select 0 t0 union select 1 union select 2 union select 3 union select 4 union select 5 union select 6 union select 7 union select 8 union select 9) t0, (select 0 t1 union select 1 union select 2 union select 3 union select 4 union select 5 union select 6 union select 7 union select 8 union select 9) t1, (select 0 t2 union select 1 union select 2 union select 3 union select 4 union select 5 union select 6 union select 7 union select 8 union select 9) t2, (select 0 t3 union select 1 union select 2 union select 3 union select 4 union select 5 union select 6 union select 7 union select 8 union select 9) t3, (select 0 t4 union select 1 union select 2 union select 3 union select 4 union select 5 union select 6 union select 7 union select 8 union select 9) t4) v Where gen_date between :startDate and :endDate) m ) m) tt LEFT JOIN dm.CampaignDetail cd on cd.StartDate >= tt.StartDate and cd.startDate <= tt.EndDate AND cd.campaignDetailSource = :source LEFT JOIN dm.CampaignAttribution ca ON cd.campaignId = ca.campaignId AND cd.startDate = ca.startDate AND cd.endDate = ca.endDate AND ca.isManual = FALSE GROUP BY cd.campaignDetailSource, tt.Label ORDER BY tt.StartDate;

report.costvsrevenue.clickcentric.monthly = SELECT round(sum(cost),2) as 'SOURCE__NAME Cost', round(sum(revenue), 2) as 'SOURCE__NAME Revenue', DATE_FORMAT(startDate, '%b-%y') as 'Label'  FROM dm.CampaignDetail  where startDate >= :startDate  and endDate <= :endDate  and campaignDetailSource = :source group by campaignDetailSource, year(startDate), month(startDate)

report.costvsrevenue.clickcentric.yearly = SELECT round(sum(cost),2) as 'SOURCE__NAME Cost', round(sum(revenue), 2) as 'SOURCE__NAME Revenue', DATE_FORMAT(startDate, '%Y') as 'Label'  FROM dm.CampaignDetail  where startDate >= :startDate  and endDate <= :endDate  and campaignDetailSource = :source group by campaignDetailSource, year(startDate)

report.costvsrevenue.clickcentric.weekly = SELECT round(sum(cost),2) as 'SOURCE__NAME Cost', round(sum(revenue), 2) as 'SOURCE__NAME Revenue', CONCAT(DATE_FORMAT(SUBSTRING_INDEX(group_concat(DISTINCT startDate ORDER BY startDate SEPARATOR ' '), ' ', 1), '%m/%d/%y'), '-' ,DATE_FORMAT(case when SUBSTRING_INDEX(group_concat(DISTINCT startDate ORDER BY startDate SEPARATOR ' '), ' ', 1) = '2017-12-26' then DATE_ADD(SUBSTRING_INDEX(group_concat(DISTINCT startDate ORDER BY startDate SEPARATOR ' '), ' ', 1), INTERVAL 5 DAY) else DATE_ADD(SUBSTRING_INDEX(group_concat(DISTINCT startDate ORDER BY startDate SEPARATOR ' '), ' ', 1), INTERVAL 6 DAY) end, '%m/%d/%y')) as 'Label' FROM dm.CampaignDetail  where startDate >= :startDate  and endDate <= :endDate and campaignDetailSource = :source group by campaignDetailSource, yearweek(startDate, 1) order by startDate;

report.productsales = select ct.transactionSource as 'Label', round(sum(case when ct.isNewMembership = 1 then ct.transactionRevenue else 0 end), 2) as 'New', round(sum(case when ct.isRenewedMembership = 1 then ct.transactionRevenue else 0 end), 2) as 'Renew', round(sum(case when ct.isNewMembership = 0 and ct.isRenewedMembership = 0 and ct.hasTI = 1 then ct.transactionRevenue else 0 end), 2) as 'TI' from CampaignTransaction ct where ct.startDate >= :startDate and ct.endDate <= :endDate and ct.transactionSource = case when ct.transactionSource = 'Facebook' then 'Facebook' else ct.createdFrom end and ct.isDefaultTransaction = 1 group by ct.transactionSource 

report.productsales.clickcentric = select case when ct.transactionSource = 'Adwords' then 'Analytics' else ct.transactionSource end as 'Label', round(sum(case when ct.isNewMembership = 1 then ct.transactionRevenue else 0 end), 2) as 'New', round(sum(case when ct.isRenewedMembership = 1 then ct.transactionRevenue else 0 end), 2) as 'Renew', round(sum(case when ct.isNewMembership = 0 and ct.isRenewedMembership = 0 and ct.hasTI = 1 then ct.transactionRevenue else 0 end), 2) as 'TI' from CampaignTransaction ct where ct.startDate >= :startDate and ct.endDate <= :endDate and ct.createdFrom IN ('SS', 'Email') group by ct.transactionSource 

report.roi.monthly = SELECT round(sum(case when :statType IN ('purchase_centric', 'weekly_stats') and cd.campaignDetailSource = 'Facebook' then (ca.revenue1DayView + ca.revenue28DayClick) else case when 'partial' = :view  then cd.revenue else case when cd.campaignDetailSource IN ('Analytics', 'Bing') then case when :statType IN ('purchase_centric', 'weekly_stats') or 'unique' = :view then (cd.uniqueAssistedConversionRevenue + cd.directConversionRevenue) else (cd.assistedConversionRevenue + cd.directConversionRevenue) end else cd.revenue end end end) / sum(cd.cost), 2) as 'SOURCE__NAME', DATE_FORMAT(cd.startdate, '%b-%y') as 'Label' from CampaignDetail cd LEFT JOIN dm.CampaignAttribution ca on cd.campaignId = ca.campaignId and cd.startDate = ca.startDate and cd.endDate = ca.endDate and ca.isManual = false where cd.startDate >= :startDate and cd.endDate <= :endDate and cd.campaignDetailSource IN (:source) group by year(cd.startdate),month(cd.startdate);
#report.roi.monthly = SELECT ifNull(round(sum(case when :statType IN ('purchase_centric', 'weekly_stats') and cd.campaignDetailSource = 'Facebook' then (ca.revenue1DayView + ca.revenue28DayClick) else case when 'partial' = :view then cd.revenue else case when cd.campaignDetailSource IN ('Analytics', 'Bing', 'StackAdapt') then case when :statType IN ('purchase_centric', 'weekly_stats') or 'unique' = :view then (cd.uniqueAssistedConversionRevenue + cd.directConversionRevenue) else (cd.assistedConversionRevenue + cd.directConversionRevenue) end else cd.revenue end end end) / sum(ifNull(cd.cost, 0)), 2), 0) as 'SOURCE__NAME', tt.Label FROM (Select Label, (CASE WHEN StartDate < :startDate THEN :startDate ELSE StartDate END) StartDate, (CASE WHEN EndDate > :endDate THEN :endDate ELSE EndDate END) EndDate from (Select distinct DATE_FORMAT(gen_date, '%b-%y') Label, DATE_SUB(gen_date, INTERVAL DAYOFMONTH(gen_date)-1 DAY) StartDate, LAST_DAY(gen_date) EndDate from (select adddate('1970-01-01',t4*10000 + t3*1000 + t2*100 + t1*10 + t0) gen_date from (select 0 t0 union select 1 union select 2 union select 3 union select 4 union select 5 union select 6 union select 7 union select 8 union select 9) t0, (select 0 t1 union select 1 union select 2 union select 3 union select 4 union select 5 union select 6 union select 7 union select 8 union select 9) t1, (select 0 t2 union select 1 union select 2 union select 3 union select 4 union select 5 union select 6 union select 7 union select 8 union select 9) t2, (select 0 t3 union select 1 union select 2 union select 3 union select 4 union select 5 union select 6 union select 7 union select 8 union select 9) t3, (select 0 t4 union select 1 union select 2 union select 3 union select 4 union select 5 union select 6 union select 7 union select 8 union select 9) t4) v Where gen_date between :startDate and :endDate ) m) tt Left JOIN CampaignDetail cd on cd.startDate between tt.StartDate and tt.EndDate AND cd.campaignDetailSource IN (:source) LEFT JOIN dm.CampaignAttribution ca on cd.campaignId = ca.campaignId and cd.startDate = ca.startDate and cd.endDate = ca.endDate and ca.isManual = false group by tt.Label order by tt.StartDate;

report.roi.yearly = SELECT round(sum(case when :statType IN ('purchase_centric', 'weekly_stats') and cd.campaignDetailSource = 'Facebook' then (ca.revenue1DayView + ca.revenue28DayClick) else case when 'partial' = :view  then cd.revenue else case when cd.campaignDetailSource IN ('Analytics', 'Bing', 'StackAdapt') then case when :statType IN ('purchase_centric', 'weekly_stats') or 'unique' = :view then (cd.uniqueAssistedConversionRevenue + cd.directConversionRevenue) else (cd.assistedConversionRevenue + cd.directConversionRevenue) end else cd.revenue end end end) / sum(cd.cost), 2) as 'SOURCE__NAME', DATE_FORMAT(cd.startdate, '%Y') as 'Label' from CampaignDetail cd LEFT JOIN dm.CampaignAttribution ca on cd.campaignId = ca.campaignId and cd.startDate = ca.startDate and cd.endDate = ca.endDate and ca.isManual = false where cd.startDate >= :startDate and cd.endDate <= :endDate and cd.campaignDetailSource IN (:source) group by year(cd.startdate);
#report.roi.yearly = SELECT ifNull(ROUND(SUM(CASE WHEN :statType IN ('purchase_centric' , 'weekly_stats') AND cd.campaignDetailSource = 'Facebook' THEN (ca.revenue1DayView + ca.revenue28DayClick) ELSE CASE WHEN 'partial' = :view THEN cd.revenue ELSE CASE WHEN cd.campaignDetailSource IN ('Analytics' , 'Bing', 'StackAdapt') THEN CASE WHEN :statType IN ('purchase_centric' , 'weekly_stats') OR 'unique' = :view THEN (cd.uniqueAssistedConversionRevenue + cd.directConversionRevenue) ELSE (cd.assistedConversionRevenue + cd.directConversionRevenue) END ELSE cd.revenue END END END) / SUM(cd.cost), 2), 0) AS 'SOURCE__NAME', tt.Label FROM ( Select Label, (CASE WHEN StartDate < :startDate THEN :startDate ELSE StartDate END) StartDate, (CASE WHEN EndDate > :endDate THEN :endDate ELSE EndDate END) EndDate From ( SELECT DISTINCT DATE_FORMAT(gen_date, '%Y') Label, DATE_SUB(gen_date, INTERVAL DAYOFYEAR(gen_date) - 1 DAY) StartDate, DATE(CONCAT(YEAR(gen_date), '-12-31')) EndDate from (select adddate('1970-01-01',t4*10000 + t3*1000 + t2*100 + t1*10 + t0) gen_date from (select 0 t0 union select 1 union select 2 union select 3 union select 4 union select 5 union select 6 union select 7 union select 8 union select 9) t0, (select 0 t1 union select 1 union select 2 union select 3 union select 4 union select 5 union select 6 union select 7 union select 8 union select 9) t1, (select 0 t2 union select 1 union select 2 union select 3 union select 4 union select 5 union select 6 union select 7 union select 8 union select 9) t2, (select 0 t3 union select 1 union select 2 union select 3 union select 4 union select 5 union select 6 union select 7 union select 8 union select 9) t3, (select 0 t4 union select 1 union select 2 union select 3 union select 4 union select 5 union select 6 union select 7 union select 8 union select 9) t4) v Where gen_date between :startDate and :endDate ) m  ) tt LEFT JOIN dm.CampaignDetail cd on Date(cd.StartDate) between tt.StartDate and tt.EndDate AND cd.campaignDetailSource IN (:source) LEFT JOIN dm.CampaignAttribution ca ON cd.campaignId = ca.campaignId AND cd.startDate = ca.startDate AND cd.endDate = ca.endDate AND ca.isManual = FALSE GROUP BY Label Order by tt.StartDate;

report.roi.weekly = SELECT round(sum(case when :statType IN ('purchase_centric', 'weekly_stats') and cd.campaignDetailSource = 'Facebook' then (ca.revenue1DayView + ca.revenue28DayClick) else case when 'partial' = :view  then cd.revenue else case when cd.campaignDetailSource IN ('Analytics', 'Bing') then case when :statType IN ('purchase_centric', 'weekly_stats') or 'unique' = :view then (cd.uniqueAssistedConversionRevenue + cd.directConversionRevenue) else (cd.assistedConversionRevenue + cd.directConversionRevenue) end else cd.revenue end end end) / sum(cd.cost), 2) as 'SOURCE__NAME', CONCAT(DATE_FORMAT(SUBSTRING_INDEX(group_concat(DISTINCT cd.startDate ORDER BY cd.startDate SEPARATOR ' '), ' ', 1), '%m/%d/%y'), '-' ,DATE_FORMAT(case when SUBSTRING_INDEX(group_concat(DISTINCT cd.startDate ORDER BY cd.startDate SEPARATOR ' '), ' ', 1) = '2017-12-26' then DATE_ADD(SUBSTRING_INDEX(group_concat(DISTINCT cd.startDate ORDER BY cd.startDate SEPARATOR ' '), ' ', 1), INTERVAL 5 DAY) else DATE_ADD(cd.startDate, INTERVAL 6 DAY) end, '%m/%d/%y')) as 'Label' from CampaignDetail cd LEFT JOIN dm.CampaignAttribution ca on cd.campaignId = ca.campaignId and cd.startDate = ca.startDate and cd.endDate = ca.endDate and ca.isManual = false where cd.startDate >= :startDate and cd.endDate <= :endDate and cd.campaignDetailSource IN (:source) group by yearweek(cd.startDate, 1) order by cd.startDate;
#report.roi.weekly = SELECT ifNull(ROUND(SUM(CASE WHEN :statType IN ('purchase_centric' , 'weekly_stats') AND cd.campaignDetailSource = 'Facebook' THEN (ca.revenue1DayView + ca.revenue28DayClick) ELSE CASE WHEN 'partial' = :view THEN cd.revenue ELSE CASE WHEN cd.campaignDetailSource IN ('Analytics' , 'Bing', 'StackAdapt') THEN CASE WHEN :statType IN ('purchase_centric' , 'weekly_stats') OR 'unique' = :view THEN (cd.uniqueAssistedConversionRevenue + cd.directConversionRevenue) ELSE (cd.assistedConversionRevenue + cd.directConversionRevenue) END ELSE cd.revenue END END END) / SUM(ifNull(cd.cost, 0)), 2), 0) AS 'SOURCE__NAME', tt.Label FROM (SELECT CONCAT(DATE_FORMAT(StartDate, '%m/%d/%y'), '-', DATE_FORMAT(EndDate, '%m/%d/%y')) Label, StartDate, EndDate FROM (SELECT (CASE WHEN StartDate < :startDate THEN :startDate ELSE StartDate END) StartDate, (CASE WHEN EndDate > :endDate THEN :endDate ELSE EndDate END) EndDate FROM (SELECT DISTINCT DATE_ADD(gen_date, INTERVAL - WEEKDAY(gen_date) DAY) StartDate, DATE_ADD(DATE_ADD(gen_date, INTERVAL - WEEKDAY(gen_date) DAY), INTERVAL 6 DAY) EndDate FROM (SELECT ADDDATE('1970-01-01', t4 * 10000 + t3 * 1000 + t2 * 100 + t1 * 10 + t0) gen_date FROM (SELECT 0 t0 UNION SELECT 1 UNION SELECT 2 UNION SELECT 3 UNION SELECT 4 UNION SELECT 5 UNION SELECT 6 UNION SELECT 7 UNION SELECT 8 UNION SELECT 9) t0, (SELECT 0 t1 UNION SELECT 1 UNION SELECT 2 UNION SELECT 3 UNION SELECT 4 UNION SELECT 5 UNION SELECT 6 UNION SELECT 7 UNION SELECT 8 UNION SELECT 9) t1, (SELECT 0 t2 UNION SELECT 1 UNION SELECT 2 UNION SELECT 3 UNION SELECT 4 UNION SELECT 5 UNION SELECT 6 UNION SELECT 7 UNION SELECT 8 UNION SELECT 9) t2, (SELECT 0 t3 UNION SELECT 1 UNION SELECT 2 UNION SELECT 3 UNION SELECT 4 UNION SELECT 5 UNION SELECT 6 UNION SELECT 7 UNION SELECT 8 UNION SELECT 9) t3, (SELECT 0 t4 UNION SELECT 1 UNION SELECT 2 UNION SELECT 3 UNION SELECT 4 UNION SELECT 5 UNION SELECT 6 UNION SELECT 7 UNION SELECT 8 UNION SELECT 9) t4) v WHERE gen_date BETWEEN :startDate AND :endDate) m) m) tt LEFT JOIN CampaignDetail cd ON cd.startDate >= tt.StartDate AND cd.endDate <= tt.EndDate AND cd.campaignDetailSource IN (:source) LEFT JOIN dm.CampaignAttribution ca ON cd.campaignId = ca.campaignId AND cd.startDate = ca.startDate AND cd.endDate = ca.endDate AND ca.isManual = FALSE Group by Label ORDER BY tt.StartDate;

report.roi.clickcentric.monthly = SELECT round(sum(revenue) / sum(cost), 2) as 'SOURCE__NAME', DATE_FORMAT(startdate, '%b-%y') as 'Label' from CampaignDetail where startDate >= :startDate and endDate <= :endDate and campaignDetailSource IN (:source) group by year(startdate),month(startdate);

report.roi.clickcentric.yearly = SELECT round(sum(revenue) / sum(cost), 2) as 'SOURCE__NAME', DATE_FORMAT(startdate, '%Y') as 'Label' from CampaignDetail where startDate >= :startDate and endDate <= :endDate and campaignDetailSource IN (:source) group by year(startdate);

report.roi.clickcentric.weekly = SELECT round(sum(revenue) / sum(cost), 2) as 'SOURCE__NAME', CONCAT(DATE_FORMAT(SUBSTRING_INDEX(group_concat(DISTINCT startDate ORDER BY startDate SEPARATOR ' '), ' ', 1), '%m/%d/%y'), '-' ,DATE_FORMAT(case when SUBSTRING_INDEX(group_concat(DISTINCT startDate ORDER BY startDate SEPARATOR ' '), ' ', 1) = '2017-12-26' then DATE_ADD(SUBSTRING_INDEX(group_concat(DISTINCT startDate ORDER BY startDate SEPARATOR ' '), ' ', 1), INTERVAL 5 DAY) else DATE_ADD(SUBSTRING_INDEX(group_concat(DISTINCT startDate ORDER BY startDate SEPARATOR ' '), ' ', 1), INTERVAL 6 DAY) end, '%m/%d/%y')) as 'Label' from CampaignDetail where startDate >= :startDate and endDate <= :endDate and campaignDetailSource IN (:source) group by yearweek(startDate, 1) order by startDate;
 
report.profitloss.monthly = SELECT round(sum(case when :statType IN ('purchase_centric', 'weekly_stats') and cd.campaignDetailSource = 'Facebook' then (ca.revenue1DayView + ca.revenue28DayClick) else case when 'partial' = :view  then cd.revenue else case when cd.campaignDetailSource IN ('Analytics', 'Bing') then case when :statType IN ('purchase_centric', 'weekly_stats') or 'unique' = :view then (cd.uniqueAssistedConversionRevenue + cd.directConversionRevenue) else (cd.assistedConversionRevenue + cd.directConversionRevenue) end else cd.revenue end end end) - sum(cost), 2) as 'SOURCE__NAME', DATE_FORMAT(cd.startdate, '%b-%y') as 'Label' from CampaignDetail cd LEFT JOIN dm.CampaignAttribution ca on cd.campaignId = ca.campaignId and cd.startDate = ca.startDate and cd.endDate = ca.endDate and ca.isManual = false where cd.startDate >= :startDate and cd.endDate <= :endDate and cd.campaignDetailSource IN (:source) group by year(cd.startdate),month(cd.startdate);
#report.profitloss.monthly = SELECT ifNull(ROUND(SUM(CASE WHEN :statType IN ('purchase_centric' , 'weekly_stats') AND cd.campaignDetailSource = 'Facebook' THEN (ca.revenue1DayView + ca.revenue28DayClick) ELSE CASE WHEN 'partial' = :view THEN cd.revenue ELSE CASE WHEN cd.campaignDetailSource IN ('Analytics' , 'Bing', 'StackAdapt') THEN CASE WHEN :statType IN ('purchase_centric' , 'weekly_stats') OR 'unique' = :view THEN (cd.uniqueAssistedConversionRevenue + cd.directConversionRevenue) ELSE (cd.assistedConversionRevenue + cd.directConversionRevenue) END ELSE cd.revenue END END END) - SUM(ifNull(cost, 0)), 2), 0) AS 'SOURCE__NAME', tt.Label FROM (Select Label, (CASE WHEN StartDate < :startDate THEN :startDate ELSE StartDate END) StartDate, (CASE WHEN EndDate > :endDate THEN :endDate ELSE EndDate END) EndDate from (Select distinct DATE_FORMAT(gen_date, '%b-%y') Label, DATE_SUB(gen_date, INTERVAL DAYOFMONTH(gen_date)-1 DAY) StartDate, LAST_DAY(gen_date) EndDate from (select adddate('1970-01-01',t4*10000 + t3*1000 + t2*100 + t1*10 + t0) gen_date from (select 0 t0 union select 1 union select 2 union select 3 union select 4 union select 5 union select 6 union select 7 union select 8 union select 9) t0, (select 0 t1 union select 1 union select 2 union select 3 union select 4 union select 5 union select 6 union select 7 union select 8 union select 9) t1, (select 0 t2 union select 1 union select 2 union select 3 union select 4 union select 5 union select 6 union select 7 union select 8 union select 9) t2, (select 0 t3 union select 1 union select 2 union select 3 union select 4 union select 5 union select 6 union select 7 union select 8 union select 9) t3, (select 0 t4 union select 1 union select 2 union select 3 union select 4 union select 5 union select 6 union select 7 union select 8 union select 9) t4) v Where gen_date between :startDate and :endDate ) m ) tt Left JOIN CampaignDetail cd on cd.startDate >= tt.StartDate and cd.startDate <= tt.EndDate AND cd.campaignDetailSource IN (:source) LEFT JOIN dm.CampaignAttribution ca ON cd.campaignId = ca.campaignId AND cd.startDate = ca.startDate AND cd.endDate = ca.endDate AND ca.isManual = FALSE GROUP BY Label ORDER BY tt.StartDate;

report.profitloss.yearly = SELECT round(sum(case when :statType IN ('purchase_centric', 'weekly_stats') and cd.campaignDetailSource = 'Facebook' then (ca.revenue1DayView + ca.revenue28DayClick) else case when 'partial' = :view  then cd.revenue else case when cd.campaignDetailSource IN ('Analytics', 'Bing', 'StackAdapt') then case when :statType IN ('purchase_centric', 'weekly_stats') or 'unique' = :view then (cd.uniqueAssistedConversionRevenue + cd.directConversionRevenue) else (cd.assistedConversionRevenue + cd.directConversionRevenue) end else cd.revenue end end end) - sum(cost), 2) as 'SOURCE__NAME', DATE_FORMAT(cd.startdate, '%Y') as 'Label' from CampaignDetail cd LEFT JOIN dm.CampaignAttribution ca on cd.campaignId = ca.campaignId and cd.startDate = ca.startDate and cd.endDate = ca.endDate and ca.isManual = false  where cd.startDate >= :startDate and cd.endDate <= :endDate and cd.campaignDetailSource IN (:source) group by year(cd.startdate);
#report.profitloss.yearly = SELECT ifNull(ROUND(SUM(CASE WHEN :statType IN ('purchase_centric' , 'weekly_stats') AND cd.campaignDetailSource = 'Facebook' THEN (ca.revenue1DayView + ca.revenue28DayClick) ELSE CASE WHEN 'partial' = :view THEN cd.revenue ELSE CASE WHEN cd.campaignDetailSource IN ('Analytics' , 'Bing', 'StackAdapt') THEN CASE WHEN :statType IN ('purchase_centric' , 'weekly_stats') OR 'unique' = :view THEN (cd.uniqueAssistedConversionRevenue + cd.directConversionRevenue) ELSE (cd.assistedConversionRevenue + cd.directConversionRevenue) END ELSE cd.revenue END END END) - SUM(cost), 2), 0) AS 'SOURCE__NAME', tt.Label FROM ( Select Label, (CASE WHEN StartDate < :startDate THEN :startDate ELSE StartDate END) StartDate, (CASE WHEN EndDate > :endDate THEN :endDate ELSE EndDate END) EndDate From ( SELECT DISTINCT DATE_FORMAT(gen_date, '%Y') Label, DATE_SUB(gen_date, INTERVAL DAYOFYEAR(gen_date) - 1 DAY) StartDate, DATE(CONCAT(YEAR(gen_date), '-12-31')) EndDate from (select adddate('1970-01-01',t4*10000 + t3*1000 + t2*100 + t1*10 + t0) gen_date from (select 0 t0 union select 1 union select 2 union select 3 union select 4 union select 5 union select 6 union select 7 union select 8 union select 9) t0, (select 0 t1 union select 1 union select 2 union select 3 union select 4 union select 5 union select 6 union select 7 union select 8 union select 9) t1, (select 0 t2 union select 1 union select 2 union select 3 union select 4 union select 5 union select 6 union select 7 union select 8 union select 9) t2, (select 0 t3 union select 1 union select 2 union select 3 union select 4 union select 5 union select 6 union select 7 union select 8 union select 9) t3, (select 0 t4 union select 1 union select 2 union select 3 union select 4 union select 5 union select 6 union select 7 union select 8 union select 9) t4) v Where gen_date between :startDate and :endDate ) m  ) tt LEFT JOIN dm.CampaignDetail cd on Date(cd.StartDate) between tt.StartDate and tt.EndDate AND cd.campaignDetailSource IN (:source) LEFT JOIN dm.CampaignAttribution ca ON cd.campaignId = ca.campaignId AND cd.startDate = ca.startDate AND cd.endDate = ca.endDate AND ca.isManual = FALSE GROUP BY Label Order by tt.StartDate;

report.profitloss.weekly = SELECT round(sum(case when :statType IN ('purchase_centric', 'weekly_stats') and cd.campaignDetailSource = 'Facebook' then (ca.revenue1DayView + ca.revenue28DayClick) else case when 'partial' = :view  then cd.revenue else case when cd.campaignDetailSource IN ('Analytics', 'Bing') then case when :statType IN ('purchase_centric', 'weekly_stats') or 'unique' = :view then (cd.uniqueAssistedConversionRevenue + cd.directConversionRevenue) else (cd.assistedConversionRevenue + cd.directConversionRevenue) end else cd.revenue end end end) - sum(cost), 2) as 'SOURCE__NAME', CONCAT(DATE_FORMAT(SUBSTRING_INDEX(group_concat(DISTINCT cd.startDate ORDER BY cd.startDate SEPARATOR ' '), ' ', 1), '%m/%d/%y'), '-' ,DATE_FORMAT(case when SUBSTRING_INDEX(group_concat(DISTINCT cd.startDate ORDER BY cd.startDate SEPARATOR ' '), ' ', 1) = '2017-12-26' then DATE_ADD(SUBSTRING_INDEX(group_concat(DISTINCT cd.startDate ORDER BY cd.startDate SEPARATOR ' '), ' ', 1), INTERVAL 5 DAY) else DATE_ADD(SUBSTRING_INDEX(group_concat(DISTINCT cd.startDate ORDER BY cd.startDate SEPARATOR ' '), ' ', 1), INTERVAL 6 DAY) end, '%m/%d/%y')) as 'Label' from CampaignDetail cd LEFT JOIN dm.CampaignAttribution ca on cd.campaignId = ca.campaignId and cd.startDate = ca.startDate and cd.endDate = ca.endDate and ca.isManual = false where cd.startDate >= :startDate and cd.endDate <= :endDate and cd.campaignDetailSource IN (:source) group by yearweek(cd.startDate, 1) order by cd.startDate;
#report.profitloss.weekly = SELECT ifNull(ROUND(SUM(CASE WHEN :statType IN ('purchase_centric' , 'weekly_stats') AND cd.campaignDetailSource = 'Facebook' THEN (ca.revenue1DayView + ca.revenue28DayClick) ELSE CASE WHEN 'partial' = :view THEN cd.revenue ELSE CASE WHEN cd.campaignDetailSource IN ('Analytics' , 'Bing', 'StackAdapt') THEN CASE WHEN :statType IN ('purchase_centric' , 'weekly_stats') OR 'unique' = :view THEN (cd.uniqueAssistedConversionRevenue + cd.directConversionRevenue) ELSE (cd.assistedConversionRevenue + cd.directConversionRevenue) END ELSE cd.revenue END END END) - SUM(ifNull(cost, 0)), 2), 0) AS 'SOURCE__NAME', tt.Label FROM (SELECT CONCAT(DATE_FORMAT(StartDate, '%m/%d/%y'), '-', DATE_FORMAT(EndDate, '%m/%d/%y')) Label, StartDate, EndDate FROM (SELECT (CASE WHEN StartDate < :startDate THEN :startDate ELSE StartDate END) StartDate, (CASE WHEN EndDate > :endDate THEN :endDate ELSE EndDate END) EndDate FROM (SELECT DISTINCT DATE_ADD(gen_date, INTERVAL - WEEKDAY(gen_date) DAY) StartDate, DATE_ADD(DATE_ADD(gen_date, INTERVAL - WEEKDAY(gen_date) DAY), INTERVAL 6 DAY) EndDate FROM (SELECT ADDDATE('1970-01-01', t4 * 10000 + t3 * 1000 + t2 * 100 + t1 * 10 + t0) gen_date FROM (SELECT 0 t0 UNION SELECT 1 UNION SELECT 2 UNION SELECT 3 UNION SELECT 4 UNION SELECT 5 UNION SELECT 6 UNION SELECT 7 UNION SELECT 8 UNION SELECT 9) t0, (SELECT 0 t1 UNION SELECT 1 UNION SELECT 2 UNION SELECT 3 UNION SELECT 4 UNION SELECT 5 UNION SELECT 6 UNION SELECT 7 UNION SELECT 8 UNION SELECT 9) t1, (SELECT 0 t2 UNION SELECT 1 UNION SELECT 2 UNION SELECT 3 UNION SELECT 4 UNION SELECT 5 UNION SELECT 6 UNION SELECT 7 UNION SELECT 8 UNION SELECT 9) t2, (SELECT 0 t3 UNION SELECT 1 UNION SELECT 2 UNION SELECT 3 UNION SELECT 4 UNION SELECT 5 UNION SELECT 6 UNION SELECT 7 UNION SELECT 8 UNION SELECT 9) t3, (SELECT 0 t4 UNION SELECT 1 UNION SELECT 2 UNION SELECT 3 UNION SELECT 4 UNION SELECT 5 UNION SELECT 6 UNION SELECT 7 UNION SELECT 8 UNION SELECT 9) t4) v WHERE gen_date BETWEEN :startDate AND :endDate) m) m ORDER BY StartDate) tt LEFT JOIN CampaignDetail cd ON cd.startDate >= tt.StartDate AND cd.endDate <= tt.EndDate AND cd.campaignDetailSource IN (:source) LEFT JOIN dm.CampaignAttribution ca ON cd.campaignId = ca.campaignId AND cd.startDate = ca.startDate AND cd.endDate = ca.endDate AND ca.isManual = FALSE GROUP BY Label ORDER BY tt.StartDate;
report.profitloss.clickcentric.monthly = SELECT round(sum(revenue) - sum(cost), 2) as 'SOURCE__NAME', DATE_FORMAT(startdate, '%b-%y') as 'Label' from CampaignDetail where startDate >= :startDate and endDate <= :endDate and campaignDetailSource IN (:source) group by year(startdate),month(startdate);

report.profitloss.clickcentric.yearly = SELECT round(sum(revenue) - sum(cost), 2) as 'SOURCE__NAME', DATE_FORMAT(startdate, '%Y') as 'Label' from CampaignDetail where startDate >= :startDate and endDate <= :endDate and campaignDetailSource IN (:source) group by year(startdate);

report.profitloss.clickcentric.weekly = SELECT round(sum(revenue) - sum(cost), 2) as 'SOURCE__NAME', CONCAT(DATE_FORMAT(SUBSTRING_INDEX(group_concat(DISTINCT startDate ORDER BY startDate SEPARATOR ' '), ' ', 1), '%m/%d/%y'), '-' ,DATE_FORMAT(case when SUBSTRING_INDEX(group_concat(DISTINCT startDate ORDER BY startDate SEPARATOR ' '), ' ', 1) = '2017-12-26' then DATE_ADD(SUBSTRING_INDEX(group_concat(DISTINCT startDate ORDER BY startDate SEPARATOR ' '), ' ', 1), INTERVAL 5 DAY) else DATE_ADD(SUBSTRING_INDEX(group_concat(DISTINCT startDate ORDER BY startDate SEPARATOR ' '), ' ', 1), INTERVAL 6 DAY) end, '%m/%d/%y')) as 'Label' from CampaignDetail where startDate >= :startDate and endDate <= :endDate and campaignDetailSource IN (:source) group by yearweek(startDate, 1) order by startDate;
